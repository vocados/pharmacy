const getKst=()=>{let t=new Date,i=t.getTime()+6e4*t.getTimezoneOffset(),a=new Date(i+324e5);return a},getDistanceFromLatLng=(t,i,a,o)=>{var n,s,l;let r=t=>Math.pow(t,2),c=6371;t*=Math.PI/180;let p=(a*=Math.PI/180)-t,m=(o-i)*(Math.PI/180);return 2*c*Math.asin(Math.sqrt(r(Math.sin(p/2))+Math.cos(t)*Math.cos(a)*r(Math.sin(m/2))))},copytoclipboard=t=>{var i=document.createElement("textarea");document.body.appendChild(i),i.value=t,i.select(),document.execCommand("copy"),document.body.removeChild(i)},inappbrowserout=()=>{copytoclipboard(window.location.href),alert('URL주소가 복사되었습니다.\n\nSafari가 열리면 주소창을 길게 터치한 뒤, "붙여놓기 및 이동"를 누르면 정상적으로 이용하실 수 있습니다.')},onclickInapp=()=>{navigator.userAgent.match(/iPhone|iPad/i)?(inappbrowserout(),location.href="x-web-search://?"):location.href="intent://"+location.href.replace(/https?:\/\//i,"")+"#Intent;scheme=http;package=com.android.chrome;end"},callAjax=(t,i)=>{var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status&&i(JSON.parse(a.responseText))},a.open("GET",t,!0),a.send()},detail=t=>{location.href=t},isInApp=()=>navigator.userAgent.match(/inapp|NAVER|KAKAOTALK|Snapchat|Line|WirtschaftsWoche|Thunderbird|Instagram|everytimeApp|WhatsApp|Electron|wadiz|AliApp|zumapp|iPhone(.*)Whale|Android(.*)Whale|kakaostory|band|twitter|DaumApps|DaumDevice\/mobile|FB_IAB|FB4A|FBAN|FBIOS|FBSS|SamsungBrowser\/[^1]/i),geolocationFunc=t=>{try{navigator&&"geolocation"in navigator&&navigator?.geolocation?.getCurrentPosition?isInApp()?t(void 0,void 0):navigator?.geolocation?.getCurrentPosition(i=>{t(i?.coords?.latitude,i?.coords?.longitude)}):t(void 0,void 0)}catch(i){t(void 0,void 0)}},numberCompare=(t,i)=>{let a=0;return t===i?a=0:t>i?a=1:t<i&&(a=-1),a},checkAvailableWorkingTime=(t,i)=>{if(!i)return!1;let a=getKst(),o=t?7:a.getDay(),n=i[o];if(!n||"-"===n)return!1;let s=a.getHours(),l=a.getMinutes(),r=n.split("~");1==(""+s).length&&(s="0"+s),1==(""+l).length&&(l="0"+l);let c=new Date("2020-01-01 "+r[0]),p=new Date("2020-01-01 "+r[1]),m=new Date("2020-01-01 "+s+":"+l);return!!(c.getTime()<m.getTime()&&p.getTime()>=m.getTime())},keyExists=(t,i)=>void 0!==t[i],init=(t,i,a)=>{var o;i.getElementById("modal").addEventListener("show.bs.modal",o=>{callAjax(`/json/${encodeURI(t.subCode)}.json`,t=>{geolocationFunc((o,n)=>{let s=[];if(o&&n){for(let l of t)if(o&&n&&l.lat&&l.lng){let r=getDistanceFromLatLng(Number(l.lat),Number(l.lng),o,n);l.distanceKm=Number(r.toFixed(2))}t&&t.length>0&&t[0]&&t[0].distanceKm&&(t=t.sort((t,i)=>numberCompare(t.distanceKm,i.distanceKm)))}for(let c of t)if(keyExists(c,"distanceKm")){let p=[];p.push('<div class="d-flex w-100 justify-content-between">'),p.push('<h5 class="mb-1">'+c.name+"</h5>"),p.push("<small>"+c.distanceKm+"km</small>"),p.push("</div>");let m=checkAvailableWorkingTime(a,c.workingTime),g="";m||(g=" list-group-item-secondary"),s.push(`<a href="javascript:;" onclick="detail('${c.url}');" class="list-group-item list-group-item-action${g}">${p.join("")}</a>`)}else s.push('<a href="javascript:;" onclick="detail(\''+c.url+'\');" class="list-group-item list-group-item-action">'+c.name+"</a>");i.getElementById("master").innerHTML=s.join("")})})});let n=getKst(),s=a?7:n.getDay(),l=$("#workingTime"),r=l.attr("init"),c=["일","월","화","수","목","금","토","공휴일"];if(navigator.userAgent.match(/inapp|NAVER|KAKAOTALK|Snapchat|Line|WirtschaftsWoche|Thunderbird|Instagram|everytimeApp|WhatsApp|Electron|wadiz|AliApp|zumapp|iPhone(.*)Whale|Android(.*)Whale|kakaostory|band|twitter|DaumApps|DaumDevice\/mobile|FB_IAB|FB4A|FBAN|FBIOS|FBSS|SamsungBrowser\/[^1]/i)){let p=[];p.push('<div class="alert alert-warning" role="alert">'),p.push('인앱 브라우저로 접속하셨나요? 기본브라우저로 접속 시 가장 가까운 약국을 찾을 수 있어요 <a href="#" onclick="onclickInapp();">바로가기</a>'),p.push("</div>"),$("#alert").html(p.join(""))}if(t.lat&&t.lng&&"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(i=>{let a=(distanceKm=getDistanceFromLatLng(Number(t.lat),Number(t.lng),i.coords.latitude,i.coords.longitude)).toFixed(2);$("#location").html(`<string>위치정보와 약 ${a}Km</strong>`)}),"true"!==r){let m=t.workingTime[s],g=[];for(let d=s;d<t.workingTime.length;d++){let u=t.workingTime[d];(a||7!==d)&&(s===d?g.push(`<li class="list-group-item"><strong>${c[d]} : ${u}</strong></li>`):g.push(`<li class="list-group-item">${c[d]} : ${u}</li>`))}if(0!==s){for(let h=0;h<s;h++){let b=t.workingTime[h];g.push(`<li class="list-group-item">${c[h]} : ${b}</li>`)}if(!a)try{g.push(`<li class="list-group-item">${c[7]} : ${t.workingTime[7]}</li>`)}catch(_){}}if($("#workingTimeBody").html(g.join("")),m&&"-"!==m){let w=n.getHours(),A=n.getMinutes(),T=m.split("~");1==(""+w).length&&(w="0"+w),1==(""+A).length&&(A="0"+A);let f=new Date("2020-01-01 "+T[0]),k=new Date("2020-01-01 "+T[1]),v=new Date("2020-01-01 "+w+":"+A);f.getTime()<v.getTime()&&k.getTime()>=v.getTime()?l.html('<span class="badge bg-primary">영업 중</span>&nbsp;&nbsp;'+T[1]+"에 영업 종료"):l.html('<span class="badge bg-secondary">영업 종료</span>&nbsp;&nbsp;'+T[1]+"에 영업 종료")}else l.html('<span class="badge bg-secondary">영업 종료</span>&nbsp;&nbsp;');l.attr("init","true")}if(t.lat&&t.lng){let y=['<div class="buttons">','<input id="interaction" type="button" name="지도 이동" value="지도 이동" class="control-btn" />',"</div>"];$("#map").html(y.join("")),$("#interaction").addClass("control-on"),$(i).on("click","#interaction",function(){e.preventDefault(),F.getOptions("draggable")?(F.setOptions({draggable:!1,pinchZoom:!1,scrollWheel:!1,keyboardShortcuts:!1,disableDoubleTapZoom:!0,disableDoubleClickZoom:!0,disableTwoFingerTapZoom:!0}),$(this).removeClass("control-on")):(F.setOptions({draggable:!0,pinchZoom:!0,scrollWheel:!0,keyboardShortcuts:!0,disableDoubleTapZoom:!1,disableDoubleClickZoom:!1,disableTwoFingerTapZoom:!1}),$(this).addClass("control-on"))});var D={center:new naver.maps.LatLng(Number(t.lat),Number(t.lng)),zoom:15,draggable:!1,pinchZoom:!1,scrollWheel:!1,keyboardShortcuts:!1,disableDoubleTapZoom:!0,disableDoubleClickZoom:!0,disableTwoFingerTapZoom:!0},F=new naver.maps.Map("map",D),B=new naver.maps.Marker({position:new naver.maps.LatLng(Number(t.lat),Number(t.lng)),map:F})}else $("#map").parent().remove()};$(document).ready(()=>{window.siteData&&callAjax("/json/holiday.json",t=>{let i=getKst().toISOString().substring(0,10);keyExists(t,i)?init(window.siteData,window.document,!0):init(window.siteData,window.document,!1)})});
